axTicks(1)
})
caiss04 <- subset(Vol, caisson %in% c("4","4A"))
caiss04
caiss04 <- caiss04[order(caiss04$caisson),]
caiss04$vol <- ifelse(caiss04$Date >="1999-10-01" & caiss04$Date <= "2003-11-03" & caiss04$caisson=="4", caiss04$vol*1000, caiss04$vol)
with(caiss04, plot(Date, vol, type='l'))
N <- nrow(caiss04)
caiss04$pumpd[2:N] <- with(caiss04, vol[2:N] - vol[1:(N-1)])
with(caiss04, {
plot(Date, pumpd, type='h')
})
caiss04
caiss04$pumpd <- with(caiss04, ifelse(pumpd < 0, NA, pumpd))
caiss04
N <- nrow(caiss04)
caiss04$pumpd[2:N] <- with(caiss04, vol[2:N] - vol[1:(N-1)])
with(caiss04, {
plot(Date, pumpd, type='h')
})
caiss04$pumpd[2:N] <- with(caiss04, vol[2:N] - vol[1:(N-1)])
caiss04$pumpd <- with(caiss04, ifelse(pumpd < 0, NA, pumpd))
caiss04
caiss04 <- subset(Vol, caisson %in% c("4","4A"))
caiss04 <- caiss04[order(caiss04$caisson),]
caiss04$vol <- ifelse(caiss04$Date >="1999-10-01" & caiss04$Date <= "2003-11-03" & caiss04$caisson=="4", caiss04$vol*1000, caiss04$vol)
with(caiss04, plot(Date, vol, type='l'))
N <- nrow(caiss04)
caiss04$pumpd[2:N] <- with(caiss04, vol[2:N] - vol[1:(N-1)])
caiss04$pumpd <- with(caiss04, ifelse(pumpd < 0, NA, pumpd))
caiss04
with(caiss04, {
plot(Date, pumpd, type='h')
})
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
caiss04$vol <- with(caiss04, ifelse(Date < "1999-10-01" & caisson=="4", vol/1000, vol))
caiss04$vol <- ifelse(caiss04$Date >="1999-10-01" & caiss04$Date <= "2003-11-03" & caiss04$caisson=="4", caiss04$vol*1000, caiss04$vol)
with(caiss04, plot(Date, vol, type='l'))
caiss04 <- subset(Vol, caisson %in% c("4","4A"))
caiss04 <- caiss04[order(caiss04$caisson),]
caiss04
caiss04$vol <- with(caiss04, ifelse(Date < "1999-10-01", vol/1000, vol))
caiss04
caiss04$vol <- ifelse(caiss04$Date >="1999-10-01" & caiss04$Date <= "2003-11-03" & caiss04$caisson=="4", caiss04$vol*1000, caiss04$vol)
caiss04
with(caiss04, plot(Date, vol, type='l'))
N <- nrow(caiss04)
caiss04$pumpd[2:N] <- with(caiss04, vol[2:N] - vol[1:(N-1)])
caiss04
caiss04$pumpd <- with(caiss04, ifelse(pumpd < 0, NA, pumpd))
caiss04
with(caiss04, {
plot(Date, pumpd, type='h', las=1)
})
with(subset(caiss04, Date > "2004-01-01"), {
plot(Date, pumpd, type='h', las=1)
})
unique(Vol$caisson)
with(subset(Vol, caisson %in% c("5","5_")), plot(Date,vol, type='l'))
caiss05 <- subset(Vol, caisson %in% c("5","5_"))
caiss05 <- caiss05[order(caiss05$caisson),]
caiss05
caiss05$vol <- with(caiss05, ifelse(Date < "1999-10-01", vol/1000, vol))
caiss05
with(caiss05, plot(Date, vol, type='l'))
N <- nrow(caiss05)
caiss05$pumpd[2:N] <- with(caiss05, vol[2:N] - vol[1:(N-1)])
caiss05
caiss05$pumpd <- with(caiss05, ifelse(pumpd < 0, NA, pumpd))
caiss05
with(subset(caiss05, Date > "2004-01-01"), {
plot(Date, pumpd, type='h', las=1)
})
with(caiss05, {
plot(Date, pumpd, type='h', las=1)
})
with(subset(caiss04, Date > "1998-01-01"), {
plot(Date, pumpd, type='h', las=1)
})
1999-10-01
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
theme_set(theme_bw())
pumphrs$time[27:nrow(pumphrs)] <- with(pumphrs, hrs[27:nrow(pumphrs)] - hrs[1:(nrow(pumphrs)-26)])
# correct negative hours
ivec <- with(pumphrs, which(time < 0))
pumphrs[ivec,]
pumphrs$time[ivec] <- NA
qplot(Date, time, data=pumphrs, color=Pump, facets=~caisson, geom='line')
# sort data on caisson name
pumphrs.srt <- pumphrs[order(pumphrs$caisson, pumphrs$Pump),]
head(pumphrs.srt, 200)
tail(pumphrs.srt, 200)
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
Vol$caisson <- ifelse(Vol$caisson=="3" | Vol$caisson=="3_", "3a", Vol$caisson)
Vol$caisson <- ifelse(Vol$caisson=="4", "4a", Vol$caisson)
Vol$caisson <- ifelse(Vol$caisson=="5" | Vol$caisson=="5_", "5a", Vol$caisson)
Vol$caisson <- ifelse(Vol$caisson=="yandilla", "Ya", Vol$caisson)
Vol$caisson <- ifelse(Vol$caisson=="Out", "Oa", Vol$caisson)
str(use)
str(Vol)
# calculate electricity consumption
use$use[27:nrow(use)] <- use$kwh[27:nrow(use)] - use$kwh[1:(nrow(use)-26)]
# calculate volume pumped
# correct for conversion from kl to Ml
Vol$vol <- with(Vol, ifelse(caisson %in% c("4a","5a") & Date < "1999-10-01", Vol$vol/1000, Vol$vol)
Vol$vol <- with(Vol, ifelse(caisson=="4a" & (Date >="1999-10-01" & Date <= "2003-11-03") ,vol*1000, vol))
Vol$vol <- with(Vol, ifelse(caisson %in% c("4a","5a") & Date < "1999-10-01", vol/1000, vol)
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
# calculate electricity consumption
use$use[27:nrow(use)] <- use$kwh[27:nrow(use)] - use$kwh[1:(nrow(use)-26)]
# calculate volume pumped
# correct for conversion from kl to Ml
Vol$vol <- with(Vol, ifelse(caisson %in% c("4a","5a") & Date < "1999-10-01", vol/1000, vol))
Vol$vol <- with(Vol, ifelse(caisson=="4a" & (Date >="1999-10-01" & Date <= "2003-11-03") ,vol*1000, vol))
subset(Vol, caisson=="4a"))
subset(Vol, caisson=="4a")
subset(Vol, caisson %in% c("4a","4A"))
subset(Vol, caisson %in% c("5a","5_"))
unique(Vol%caisson)
unique(Vol$caisson)
subset(Vol, caisson %in% c("5a"))
caisson <- ifelse(nchar(Vol$caisson)==2, substr(Vol$caisson,1,1),' ')
subcaiss <- ifelse(nchar(Vol$caisson)==2, substr(Vol$caisson,2,2),Vol$caisson)
Vol <- data.frame(caisson, subcaiss, Vol[,2:4])
caisson
subcaiss
Vol[,2:4]
str(Vol)
Vol <- data.frame(caisson, subcaiss, Vol[,2:3])
# test for negative values of power consumption
ivec <- which(use$use < 0)
use[ivec,]
if(length(ivec)>0) use$use[ivec] <- NA
# test for negative values for Volume pumped
Vol$Vol <- NA
Vol$Vol[6:310] <- Vol$vol[6:310] - Vol$vol[1:305]
Vol$Vol[324:nrow(Vol)] <- Vol$vol[324:nrow(Vol)] - Vol$vol[311:(nrow(Vol)-13)]
subset(Vol, caisson=="5a")
ivec <- which(Vol$Vol < 0)
Vol[ivec,]
if(length(ivec)>0) Vol$Vol[ivec] <- Vol$vol[ivec]
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
ivec <- which(Vol$Vol < 0)
Vol[ivec,]
if(length(ivec)>0) Vol$Vol[ivec] <- NA
# sort data on caisson name
use.srt <- use[order(use$caisson, use$tariff),]
head(use.srt, 20)
tail(use.srt, 20)
Vol.srt <- Vol[order(Vol$caisson, Vol$subcaiss),]
head(Vol.srt, 20)
tail(Vol.srt, 20)
# copy sorted data back to original
pumphrs <- pumphrs.srt
use <- use.srt
Vol <- Vol.srt
rm(pumphrs.srt, use.srt, Vol.srt)
# renumber sorted rows in sequence
rownames(pumphrs) <- 1:nrow(pumphrs)
rownames(use) <- 1:nrow(use)               Change in In-stream Salinity from Interception of Saline Groundwater Discharge into the Lower River Murray, Australia
rownames(use) <- 1:nrow(use)
rownames(Vol) <- 1:nrow(Vol)
Vol$caisson <- as.character(Vol$caisson)
# plot electricty consumption
qplot(Date, use, data=use, color=tariff, facets=~caisson, geom='line')
# plot vol pumped from caissons
qplot(Date, Vol, data=Vol, facets=~caisson, geom='line')
subset(Vol, caisson=="4")
subset(Vol, caisson=="5")
subset(Vol, caisson=="3")
subset(Vol, caisson=="6")
subset(Vol, caisson=="1")
subset(Vol, caisson=="2")
temp <- subset(Vol, caisson != "4" & subcaiss == "B")
subset(Vol, caisson == "4" & subcaiss == "B")
temp
subset(Vol, caisson == "4" & subcaiss == "B")
subset(Vol, !(caisson == "4" & subcaiss == "B"))
temp <- subset(Vol, !(caisson == "4" & subcaiss == "B"))
ls()
rm(temp, caiss04, caiss05)
require(DAAG)
ifelse(is.nan(pumphrs$hrs), NA, pumphrs$hrs)
pumphrs$hrs <- ifelse(is.nan(pumphrs$hrs), NA, pumphrs$hrs)
str(pumphrs)
caissons <- unique(pumphrs$caisson)
for (i in 1:length(caissons)) {
print(xyplot(time~Date, groups=Pump, data=subset(pumphrs, caisson==caissons[i]),
type='l', col=c('red','blue'), xlab="Year", ylab="Pump Hours",
main=paste("Caisson ", caissons[i])))
pause()
}
caissons <- unique(use$caisson)
for (i in 1:length(caissons)) {
print(xyplot(use~Date, groups=tariff, data=subset(use, caisson==caissons[i]),
type='l', col=c('red','blue'), xlab="Year", ylab="Electricity Use(kwh)",
main=paste("Caisson ", caissons[i])))
pause()
}
Vol$Vol <- with(Vol, ifelse(caisson %in% c("1","2","3","4","6"), Vol/1000, Vol))
caissons <- unique(Vol$caisson)
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
caissons <- unique(Vol$caisson)
for (i in 1:length(caissons)) {
print(xyplot(Vol~Date, groups=subcaiss, data=subset(Vol, caisson==caissons[i]),
type='l', col=c('red','blue'), xlab="Year", ylab="Volume pumped (Ml)",
main=paste("Caisson ", caissons[i])))
pause()
}
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
hrsyr <- with(pumphrs, aggregate(hrs, by=list(substr(Date, 1,4), caisson),sum, na.rm=T))
names(hrsyr) <- c('year','caisson','cumhours')
hrsyr$year <- as.integer(hrsyr$year)
head(hrsyr)
timeyr <- with(pumphrs, aggregate(time, by=list(substr(Date, 1,4), caisson),sum, na.rm=T))
names(timeyr) <- c('year','caisson','hours')
timeyr$year <- as.integer(timeyr$year)
timeyr
hrsyr
nrow(timeyr); nrow(kwhyear)
#  aggregate use by year and caisson
annVol <- with(Vol, aggregate(Vol, by=list(substr(Date, 1,4), caisson),sum, na.rm=T))
names(annVol) <- c('year','caisson','vol')
annVol$year <- as.integer(annVol$year)
annVol$caisson <- as.numeric(annVol$caisson)
head(annVol, 20)
annVol
nrow(annVol)
caissdat <- data.frame(hrsyr[,], timeyr[,3], kwhyear[,3])
names(caissdat)[4:5] <- c('hours','cumkwh')
caissdat$caisson <- factor(caissdat$caisson)
head(caissdat)
hrsyr <- with(pumphrs, aggregate(hrs, by=list(substr(Date, 1,4), caisson),sum, na.rm=T))
names(hrsyr) <- c('year','caisson','cumhours')
hrsyr$year <- as.integer(hrsyr$year)
hrsyr
hrsyr <- with(pumphrs, aggregate(hrs, by=list(substr(Date, 1,4), caisson),sum, na.rm=T))
names(hrsyr) <- c('year','caisson','cumhours')
hrsyr$year <- as.integer(hrsyr$year)
head(hrsyr, 20)
timeyr <- with(pumphrs, aggregate(time, by=list(substr(Date, 1,4), caisson),sum, na.rm=T))
names(timeyr) <- c('year','caisson','hours')
timeyr$year <- as.integer(timeyr$year)
head(timeyr, 20)
# aggregate use by year and caisson
Kwyear <- with(use, aggregate(use, by=list(substr(Date, 1,4), caisson),sum, na.rm=T))
names(Kwyear) <- c('year','caisson','Kw')
Kwyear$year <- as.integer(kwhyear$year)
head(Kwyear, 20)
nrow(timeyr); nrow(Kwyear)
#  aggregate use by year and caisson
annVol <- with(Vol, aggregate(Vol, by=list(substr(Date, 1,4), caisson),sum, na.rm=T))
names(annVol) <- c('year','caisson','Ml')
annVol$year <- as.integer(annVol$year)
annVol$caisson <- as.numeric(annVol$caisson)
annVol
nrow(annVol)
# merge yearly pump hours and electricity use
caissdat <- data.frame(hrsyr[,], timeyr[,3], Kwyear[,3])
str(caissdat)
names(caissdat)[4:5] <- c('hours','cumKw')
caissdat$caisson <- factor(caissdat$caisson)
head(caissdat)
# merge yearly pump hours, electricity use and volume pumped
df1 <- merge(annVol, timeyr)
df1 <- df1[order(df1$caisson, df1$year),]
head(df1, 50)
df2 <- merge(annVol, kwhyear)
df2 <- df2[order(df2$caisson, df2$year),]
head(df2, 50)
df3 <- merge(df1, df2)
df3 <- df3[order(df3$caisson, df3$year),]
df3 <- subset(df3, vol > 0)
df3 <- subset(df3, Ml > 0)
head(df3, 50)
theme_set(theme_bw())
qplot(kwh, vol, data=df3, facets=.~caisson)
qplot(kwh, Ml, data=df3, facets=.~caisson)
df3[df3$caisson=="5",]
p <- ggplot(df3, aes(year, vol)) + geom_line()
p + facet_wrap(~caisson, scales="free_y")
p <- ggplot(df3, aes(year, Ml)) + geom_line()
p + facet_wrap(~caisson, scales="free_y")
p <- ggplot(df3, aes(kwh, Ml)) + geom_point()
p + facet_wrap(~caisson, scales="free")
p <- ggplot(df3, aes(hours, Ml)) + geom_point()
p + facet_wrap(~caisson, scales="free")
for (n in 1:6) {
print(subset(df3, caisson==n))
pause()
}
with(subset(df3, year > 2002), {
print(summary(lm(lm(vol~kwh-1))))
plot(kwh,vol, col=as.integer(caisson), pch=16,
xlab="power consumption (kw)", ylab="Volume pumped (Ml)")
abline(a=0, b=coef(lm(vol~kwh-1)))
legend("topleft", legend=c("caisson 1","caisson 2","caisson 3","caisson 4","caisson 5","caisson 6","fitted"), pch=16, col=c(1:6), lty=c(0,0,0,0,0,0,1))
})
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
with(subset(df3, year > 2002), {
print(summary(lm(lm(Ml~kwh-1))))
plot(kwh,Ml, col=as.integer(caisson), pch=15+as.integer(caisson),
xlab="power consumption (kw)", ylab="Volume pumped (Ml)")
abline(a=0, b=coef(lm(Ml~kwh-1)))
legend("topleft", legend=c("caisson 1","caisson 2","caisson 3","caisson 4","caisson 5","caisson 6","fitted"), pch=16, col=c(1:6), lty=c(0,0,0,0,0,0,1))
})
df3$caisson <- factor(df3$caisson)
summary(powerTransform(vol~kwh, data=subset(df3, caisson==1 & year>2004)))
summary(powerTransform(Ml~kwh, data=subset(df3, caisson==1 & year>2004)))
caiss01.lm01 <- lm(Ml~kwh-1, data=subset(df3, caisson==1 & year>2004))
anova(caiss01.lm01)
summary(caiss01.lm01)
par(mfrow=c(2,2))
plot(caiss01.lm01)
par(mfrow=c(1,1))
with(subset(df3, caisson==1 & year>2005), plot(kwh,Ml, pch=16, col='blue', xlab='Power Consumption (kilowatts)', ylab='Volume pumped (Ml)'))
with(subset(df3, caisson==1 & year>2004), plot(kwh,Ml, pch=16, col='blue', xlab='Power Consumption (kilowatts)', ylab='Volume pumped (Ml)'))
abline(a=0, b=coef(caiss01.lm01), lty=2, col="red")
summary(powerTransform(Ml~kwh, data=subset(df3, caisson==1 & year>2005)))
caiss01.lm01 <- lm(Ml~kwh-1, data=subset(df3, caisson==1 & year>2005))
anova(caiss01.lm01)
summary(caiss01.lm01)
par(mfrow=c(2,2))
plot(caiss01.lm01)
par(mfrow=c(1,1))
with(subset(df3, caisson==1 & year>2005), plot(kwh,Ml, pch=16, col='blue', xlab='Power Consumption (kilowatts)', ylab='Volume pumped (Ml)'))
abline(a=0, b=coef(caiss01.lm01), lty=2, col="red")
# update - add sqr term
caiss01.lm02 <- update(caiss01.lm01, .~.+I(kwh*kwh))
anova(caiss01.lm02, caiss01.lm01)
anova(caiss01.lm02)
summary(caiss01.lm02)
par(mfrow=c(2,2))
plot(caiss01.lm02)
par(mfrow=c(1,1))
with(subset(df3, caisson==1 & year>2005), plot(kwh, Ml, pch=16, col='blue', xlab='Power Consumption (kilowatts)', ylab='Volume pumped (Ml)'))
new <- data.frame(kwh = seq(0, 12000, 100))
lines(new$kwh, predict(caiss01.lm02, new), lty=2, col='red')
# caisson 2
summary(powerTransform(Ml~kwh, data=subset(df3, caisson==2 & year>2005)))
caiss02.lm01 <- lm(Ml~kwh-1, data=subset(df3, caisson==2 & year>2005))
anova(caiss02.lm01)
summary(caiss02.lm01)
par(mfrow=c(2,2))
plot(caiss02.lm01)
par(mfrow=c(1,1))
with(subset(df3, caisson==2 & year>2005), plot(kwh,Ml, pch=16, col='blue', xlab='Power Consumption (kilowatts)', ylab='Volume pumped (Ml)'))
abline(a=0, b=coef(caiss02.lm01), lty=2, col="red")
# caisson 3
summary(powerTransform(Ml~kwh, data=subset(df3, caisson==3 & year>2005)))
caiss03.lm01 <- lm(Ml~kwh-1, data=subset(df3, caisson==3 & year>2005))
anova(caiss03.lm01)
summary(caiss03.lm01)
par(mfrow=c(2,2))
plot(caiss03.lm01)
par(mfrow=c(1,1))
with(subset(df3, caisson==3 & year>2005), plot(kwh,Ml, pch=16, col='blue', xlab='Power Consumption (kilowatts)', ylab='Volume pumped (Ml)'))
abline(a=0, b=coef(caiss03.lm01), lty=2, col="red")
# caisson 4
summary(powerTransform(Ml~kwh, data=subset(df3, caisson==4 & year>2005)))
caiss04.lm01 <- lm(Ml~kwh-1, data=subset(df3, caisson==4 & year>2005))
anova(caiss04.lm01)
summary(caiss04.lm01)
par(mfrow=c(2,2))
plot(caiss04.lm01)
par(mfrow=c(1,1))
with(subset(df3, caisson==4 & year>2005), plot(kwh,Ml, pch=16, col='blue', xlab='Power Consumption (kilowatts)', ylab='Volume pumped (Ml)'))
abline(a=0, b=coef(caiss04.lm01), lty=2, col="red")
# caisson 5
summary(powerTransform(Ml~kwh, data=subset(df3, caisson==5 & year>2005)))
caiss05.lm01 <- lm(Ml~kwh-1, data=subset(df3, caisson==5 & year>2005))
anova(caiss05.lm01)
summary(caiss05.lm01)
par(mfrow=c(2,2))
plot(caiss05.lm01)
par(mfrow=c(1,1))
with(subset(df3, caisson==5 & year>2005), plot(kwh,Ml, pch=16, col='blue', xlab='Power Consumption (kilowatts)', ylab='Volume pumped (Ml)'))
abline(a=0, b=coef(caiss05.lm01), lty=2, col="red")
# caisson 6
summary(powerTransform(Ml~kwh, data=subset(df3, caisson==6 & year>2005)))
caiss06.lm01 <- lm(Ml~kwh-1, data=subset(df3, caisson==6 & year>2005))
anova(caiss06.lm01)
summary(caiss06.lm01)
par(mfrow=c(2,2))
plot(caiss06.lm01)
par(mfrow=c(1,1))
with(subset(df3, caisson==6 & year>2005), plot(kwh,Ml, pch=16, col='blue', xlab='Power Consumption (kilowatts)', ylab='Volume pumped (Ml)'))
abline(a=0, b=coef(caiss06.lm01), lty=2, col="red")
# caisson 4 before 2006
summary(powerTransform(vol~kwh, data=subset(df3, caisson==4 & year<=2005)))
summary(powerTransform(Ml~kwh, data=subset(df3, caisson==4 & year<=2005)))
caiss04.lm02 <- lm(Ml~kwh-1, data=subset(df3, caisson==4 & year<=2005))
anova(caiss04.lm02)
summary(caiss04.lm02)
par(mfrow=c(2,2))
plot(caiss04.lm02)
par(mfrow=c(1,1))
caiss04.lm01 <- lm(Ml~kwh-1, data=subset(df3, caisson==4 & year>2005))
caiss04b.lm02 <- lm(Ml~kwh-1, data=subset(df3, caisson==4 & year<=2005))
anova(caiss04b.lm02)
summary(caiss04b.lm02)
par(mfrow=c(2,2))
plot(caiss04b.lm02)
par(mfrow=c(1,1))
with(subset(df3, caisson==4 & year<=2005), plot(kwh,vol, pch=16, col='blue', xlab='Power Consumption (kilowatts)', ylab='Volume pumped (Ml)'))
abline(a=0, b=coef(caiss04b.lm02), lty=2, col="red")
with(subset(df3, caisson==4 & year<=2005), plot(kwh, Ml, pch=16, col='blue', xlab='Power Consumption (kilowatts)', ylab='Volume pumped (Ml)'))
abline(a=0, b=coef(caiss04b.lm02), lty=2, col="red")
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
summary(powerTransform(Ml~kwh, data=subset(df3, caisson==5 & year<=2005)))
caiss05.lm02 <- lm(Ml~sqrt(kwh)-1, data=subset(df3, caisson==5 & year<=2005))
anova(caiss05.lm02)
summary(caiss05.lm02)
par(mfrow=c(2,2))
plot(caiss05.lm02)
par(mfrow=c(1,1))
caiss05.lm02 <- lm(Ml~kwh-1, data=subset(df3, caisson==5 & year<=2005))
anova(caiss05.lm02)
summary(caiss05.lm02)
par(mfrow=c(2,2))
plot(caiss05.lm02)
par(mfrow=c(1,1))
with(subset(df3, caisson==5 & year<=2005), plot(kwh,Ml, pch=16, col='blue', xlab='Power Consumption (kilowatts)', ylab='Volume pumped (Ml)'))
new <- data.frame(kwh = seq(0, 2200, 100))
lines(new$kwh, predict(caiss05.lm02, new), lty=2, col='red')
summary(powerTransform(Ml~kwh, data=subset(df3, caisson==5 & year<=2005)))
caiss05.lm02 <- lm(Ml~sqrt(kwh)-1, data=subset(df3, caisson==5 & year<=2005))
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
# plot out all data
xyplot(Ml~kwh, groups=caisson, data=df3,
panel=function(x,y){
panel.xyplot(x,y)
panel.abline(lm(y~x))
},
pch=16,
col=as.numeric(caisson)+1
)
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
xyplot(Ml~kwh, groups=caisson, data=df3[df3$caisson!=5], pch=16,
panel=function(x,y){
panel.xyplot(x,y)
panel.abline(lm(y~x))
},
pch=16,
col=as.numeric(caisson)+1
)
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
str(df3)
subset(df3, caisson!="5")
xyplot(Ml~kwh, groups=caisson, data=subset(df3, caisson!="5"), pch=16,
panel=function(x,y){
panel.xyplot(x,y)
panel.abline(lm(y~x))
},
pch=16,
col=as.numeric(caisson)+1
)
with(subset(df3, year > 2002, & caisson !="5"), {
print(summary(lm(lm(Ml~kwh-1))))
plot(kwh,Ml, col=as.integer(caisson), pch=15+as.integer(caisson),
xlab="power consumption (kw)", ylab="Volume pumped (Ml)")
str(df3)
with(subset(df3, year > 2002 & caisson !="5"), {
print(summary(lm(lm(Ml~kwh-1))))
plot(kwh,Ml, col=as.integer(caisson), pch=15+as.integer(caisson),
xlab="power consumption (kw)", ylab="Volume pumped (Ml)")
abline(a=0, b=coef(lm(Ml~kwh-1)))
legend("topleft", legend=c("caisson 1","caisson 2","caisson 3","caisson 4","caisson 5","caisson 6","fitted"), pch=16, col=c(1:6), lty=c(0,0,0,0,0,0,1))
})
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
as.integer(df3$caisson)
as.integer(df3[df3$caisson!="5"]$caisson)
as.integer(df3[df3$caisson!="5",]$caisson)
sumps <- as.integer(df3[df3$caisson!="5",]$caisson)
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
str(caissdat)
theme_set(theme_bw())
# hours pumped
p <- ggplot(caissdat, aes(year, hours)) + geom_line()
p + facet_wrap(~caisson, scales="free_y", nrow=2)
# power consumption
p <- ggplot(caissdat, aes(year, cumKw)) + geom_line()
p + facet_wrap(~caisson, scales="free_y", nrow=2)
# hours pumped vs power consumption
p <- ggplot(caissdat, aes(cumKw, hours)) + geom_point()
p + facet_wrap(~caisson, scales="free")
p <- ggplot(subset(df3, year > 2003 & caisson !="5"), aes(kwh, Ml)) + geom_point()
p
p + geom_smooth()
p + geom_smooth(method="lm")
CDS <- with(caissdat, aggregate(ml, by=list(year),sum, na.rm=T))
CDS <- with(caissdat, aggregate(Ml, by=list(year),sum, na.rm=T))
str(caissdat)
caissdat$Ml <- with(caissdat, cumKw * 0.0124)
p <- ggplot(caissdat, aes(year, Ml)) + geom_line()
p + facet_wrap(~caisson, scales="free_y")
# sum over all caissons
CDS <- with(caissdat, aggregate(Ml, by=list(year),sum, na.rm=T))
names(CDS) <- c("year","Ml")
with(CDS, plot(Ml~year, type='l', col="blue", xlab="Year", ylab="CDS Volume (Ml)"))
# writeout to Excel spreadsheet derived datasets
file <- "derived.xlsx"
write.xlsx2(caissdat, file, sheetName="AllCaisson")
write.xlsx2(df3, file, sheetName="volumes", append=T)
write.xlsx2(CDS, file, sheetName="EstCDSVol", append=T)
q()
