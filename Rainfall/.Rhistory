source('C:/Users/Tony/AppData/Roaming/Tinn-R/tmp/sgInfo.R')
startSocketServer(port=8889)
require(xlsx)
# read in amended Berri rainfall
xlsxin <- choose.files("*.xlsx")
berri <- read.xlsx(xlsxin, sheetname="Berri", stringsAsFactors=F, header=T)
?read.xlsx
berri <- read.xlsx2(xlsxin, sheetName="Berri", stringsAsFactors=F, header=T)
head(berri, 20)
is.na(berri$Jan)
str(berri)
berri <- read.xlsx2(xlsxin, sheetName="Berri", stringsAsFactors=F, header=T, colClasses=c(rep(character,2), rep(numeric, 13)))
berri <- read.xlsx2(xlsxin, sheetName="Berri", stringsAsFactors=F, header=T, colClasses=c(rep('character',2), rep('numeric', 13)))
head(berri, 20)
str(berri)
is.na(berri)
is.nan(berri$Jan)
str(berri)
berri <- read.xlsx2(xlsxin, sheetName="Berri", stringsAsFactors=F, header=T, colClasses=c(rep('character',2), rep('numeric', 14)))
str(berri)
is.nan(berri[, 3:16])
head(berri, 20)
for (i in 3:16) {
berri[,i] <- ifelse(is.nan(berri[, i]), NA, berri[,i])
}
head(berri, 20)
random.imp <- function (a){
missing <- is.na(a)
n.missing <- sum(missing)
a.obs <- a[!missing]
imputed <- a
imputed[missing] <- sample (a.obs, n.missing, replace=TRUE)
return (imputed)
}
require(DAAG)
N <- nrow(berri)
months <- c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec")
X <- data.frame(rep(berri[,1], times=2), rep(c("obs","imp"), each=N))
names(X) <- c("year","values")
for (m in 1:12) {
X[,m+2] <- c(berri[,m+1], random.imp(berri[,m+1]))
names(X)[m+2] <- months[m]
print(histogram( ~ X[,m+2] | X$values, xlab="Rainfall (mm)", main=paste("Histogram of rainfall for the month of ",months[m])))
pause()
}
head(X)
X <- data.frame(rep(berri[,3], times=2), rep(c("obs","imp"), each=N))
names(X) <- c("year","values")
head(X)
head(berri, 20)
N <- nrow(berri)
months <- c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec")
X <- data.frame(rep(berri[,3], times=2), rep(c("obs","imp"), each=N))
names(X) <- c("year","values")
for (m in 1:12) {
X[,m+2] <- c(berri[,m+3], random.imp(berri[,m+3]))
names(X)[m+2] <- months[m]
print(histogram( ~ X[,m+2] | X$values, xlab="Rainfall (mm)", main=paste("Histogram of rainfall for the month of ",months[m])))
pause()
}
require(Amelia)
chooseCRANmirror()
utils:::menuInstallPkgs()
require(Amelia)
?Amelia
??Amelia
head(berri, 20)
months <- c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec")
berri.imp <- amelia(berri, m=20, p2s=1, idvars=c("Year"), logs=months)
berri.imp <- amelia(berri, m=20, p2s=1, idvars=c("Product.code","Staion.Number"), ts="Year", logs=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))
berri.imp <- amelia(berri, m=20, p2s=1, idvars=c("Product.code","Station.Number"), ts="Year", logs=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))
berri.imp <- amelia(berri, m=20, p2s=1, idvars=c("Product.code","Station.Number"), ts="Year", logs=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","Annual"))
berri.imp <- amelia(berri,1:15], m=20, p2s=1, idvars=c("Product.code","Station.Number"), ts="Year", logs=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))
berri.imp <- amelia(berri[,1:15], m=20, p2s=1, idvars=c("Product.code","Station.Number"), ts="Year", logs=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))
head(berri)
head(berri.imp)
str(berri.imp)
str(berri.imp[1])
str(berri.imp$imp1)
str(berri.imp[$][1]$imp1)
str(berri.imp[[1]]$imp1)
berri.imp <- amelia(berri[,1:15], m=20, p2s=1, idvars=c("Product.code","Station.Number"), logs=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))
str(berri.imp[[1]]$imp1)
berri.imp <- amelia(berri, m=20, p2s=1, idvars=c("Product.code","Station.Number"), logs=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))
imp1 <- berri.imp[[1]]$imp1
head(imp1, 20)
head(berri, 20)
plot(berri.imp, which.vars=c(2:4,6))
par(mfrow=c(2,2))
plot(berri.imp, which.vars=c(3:15))
par(mfrow=c(1,1))
par(mfrow=c(2,2))
plot(berri.imp, which.vars=c(4:15))
par(mfrow=c(1,1))
par(mfrow=c(2,2))
plot(berri.imp, which.vars=c(4:15))
berri.imp <- amelia(berri[,1:15], m=20, p2s=1, idvars=c("Product.code","Station.Number","Year"), logs=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))
par(mfrow=c(2,2))
plot(berri.imp, which.vars=c(4:15))
par(mfrow=c(1,1))
berri.imp <- amelia(berri[,1:15], m=20, p2s=1, idvars=c("Product.code","Station.Number","Year"))
par(mfrow=c(2,2))
plot(berri.imp, which.vars=c(4:15))
berri.imp <- amelia(berri[,1:15], m=20, p2s=1, idvars=c("Product.code","Station.Number","Year"), polytime=3)
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
berri.imp <- amelia(berri[,1:15], m=20, p2s=1, idvars=c("Product.code","Station.Number","Year"), ts=months, polytime=3)
berri.imp <- amelia(berri[,1:15], m=20, p2s=1, idvars=c("Product.code","Station.Number"), ts="Year", polytime=3)
par(mfrow=c(2,2))
plot(berri.imp, which.vars=c(4:15))
berri.imp <- amelia(berri[,1:15], m=20, p2s=1, idvars=c("Product.code","Station.Number"), ts="Year", polytime=5)
berri.imp <- amelia(berri[,1:15], m=20, p2s=1, idvars=c("Product.code","Station.Number"), ts="Year", splinetime=5)
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
berri.imp <- amelia(berri[,1:15], m=20, p2s=1, idvars=c("Product.code","Station.Number"), ts="Year", splinetime=2)
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
berri.imp <- amelia(berri[,1:15], m=20, p2s=1, idvars=c("Product.code","Station.Number"), ts="Year", splinetime=4, sqrts=months)
par(mfrow=c(2,2))
plot(berri.imp, which.vars=c(4:15))
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
berri.imp[[]]$imp1
berri.imp[[1]]$imp1
berri.imp[[2]]$imp1
berri.imp[[1]]$imp2
disperse(berri.imp, m=20, dims=1)
berri.imp$imp[[i]]$Jan
i
nrow <- nrow(berri.imp$imp[[1]])
ncol <- berri.imp$m
nrow
ncol
ave_mm <- matrix(nrow=nrow, ncol=ncol)
ave_mm
for (i in 1:berri.imp$m) ave_mm[,i] <- berri.imp$imp[[i]]$Jan
ave_mm
mm <- rowMeans(ave_mm)
mm
q()
source('C:/Users/Tony/AppData/Roaming/Tinn-R/tmp/sgInfo.R')
startSocketServer(port=8889)
ls()
require(DAAG)
N <- nrow(berri)
months <- c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec")
X <- data.frame(rep(berri[,3], times=2), rep(c("obs","imp"), each=N))
names(X) <- c("year","values")
for (m in 1:12) {
X[,m+2] <- c(berri[,m+3], random.imp(berri[,m+3]))
names(X)[m+2] <- months[m]
print(histogram( ~ X[,m+2] | X$values, xlab="Rainfall (mm)", main=paste("Histogram of rainfall for the month of ",months[m])))
pause()
}
?samp0le
?sampple
?sample
berri[1:N, 2:13] <- X[(N+1):(2*N), 3:14]
head(berri, 20)
xlsxin
berri <- read.xlsx2(xlsxin, sheetName="Berri", stringsAsFactors=F, header=T, colClasses=c(rep('character',2), rep('numeric', 14)))
require(xlsx)
berri <- read.xlsx2(xlsxin, sheetName="Berri", stringsAsFactors=F, header=T, colClasses=c(rep('character',2), rep('numeric', 14)))
str(berri)
# replace NaN with NA
for (i in 3:16) {
for (i in 4:16) {
berri[,i] <- ifelse(is.nan(berri[, i]), NA, berri[,i])
}
head(berri, 20)
for (i in 4:16) {
berri[,i] <- ifelse(is.nan(berri[, i]), NA, berri[,i])
}
head(berri, 20)
N <- nrow(berri)
months <- c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec")
X <- data.frame(rep(berri[,3], times=2), rep(c("obs","imp"), each=N))
names(X) <- c("year","values")
for (m in 1:12) {
X[,m+2] <- c(berri[,m+3], random.imp(berri[,m+3]))
names(X)[m+2] <- months[m]
print(histogram( ~ X[,m+2] | X$values, xlab="Rainfall (mm)", main=paste("Histogram of rainfall for the month of ",months[m])))
pause()
}
berri[1:N, 4:16] <- X[(N+1):(2*N), 3:14]
head(berri, 20)
write.xlsx(berri, xlsxout, sheetName="Berri Imputed", showNA=TRUE, append=TRUE)
xlsxin
write.xlsx(berri, xlsxin, sheetName="Berri Imputed", showNA=TRUE, append=TRUE)
write.xlsx(berri, xlsxin, sheetName="Berri_Imputed", showNA=TRUE, append=TRUE)
berri <- read.xlsx2(xlsxin, sheetName="Berri", stringsAsFactors=F, header=T, colClasses=c(rep('character',2), rep('numeric', 14)))
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
head(berri, 20)
N <- nrow(berri)
months <- c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec")
X <- data.frame(rep(berri[,3], times=2), rep(c("obs","imp"), each=N))
head(X)
names(X) <- c("year","values")
head(X)
m
berri[,m+3]
random.imp(berri[,m+3])
c(berri[,m+3], random.imp(berri[,m+3]))
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
head(berri)
head(X)
?rowsum
rowsum(X[,3:14])
rowsum(X[,3:14], year)
rowsum(X[,3:14], year)
?rowSum
?rowSums
rowSums(X[,3:14])
X$Annual <- rowSums(X[, 3:14])
str(X)
berri[1:N, 4:16] <- X[(N+1):(2*N), 3:15]
head(berri, 20)
write.xlsx(berri, xlsxin, sheetName="Berri_Imputed", showNA=TRUE, append=TRUE)
write.xlsx(berri, xlsxin, sheetName="Berri_Imputed", showNA=TRUE, append=TRUE)
q()
source('C:/Users/Tony/AppData/Roaming/Tinn-R/tmp/sgInfo.R')
startSocketServer(port=8889)
require(xlsx)
require(Amelia)
require(DAAG)
# read in amended Barmera & Kingston-on-Murray rainfall
xlsxin <- choose.files("*.xlsx")
barmera <- read.xlsx2(xlsxin, sheetName="Barmera", stringsAsFactors=F, header=T, colClasses=c(rep('character',2), rep('numeric', 14)))
str(barmera)
kom <- read.xlsx2(xlsxin, sheetName="Kingston-on-Murray", stringsAsFactors=F, header=T, colClasses=c(rep('character',2), rep('numeric', 14)))
str(kom)
# replace NaN with NA
for (i in 4:16) {
barmera[,i] <- ifelse(is.nan(barmera[, i]), NA, barmera[,i])
kom[,i] <- ifelse(is.nan(kom[, i]), NA, kom[,i])
}
head(barmera, 20); head(kom)
head(barmera, 20); head(kom, 20)
ifelse(kom$Year[year]==barmera$Year[year], mean(kom[year, 4:16], barmera[year, 4:16]), kom[year, 4:16])
barmera <- read.xlsx2(xlsxin, sheetName="Barmera", stringsAsFactors=F, header=T, colClasses=c(rep('character',2), rep('numeric', 14)))
str(barmera)
kom <- read.xlsx2(xlsxin, sheetName="Kingston-on-Murray", stringsAsFactors=F, header=T, colClasses=c(rep('character',2), rep('numeric', 14)))
str(kom)
# replace NaN with NA
for (i in 4:16) {
barmera[,i] <- ifelse(is.nan(barmera[, i]), NA, barmera[,i])
kom[,i] <- ifelse(is.nan(kom[, i]), NA, kom[,i])
}
head(barmera, 20); head(kom, 20)
mnth <- 2
mnth <- 4
ifelse(is.na(kom[,mnth]) & is.na(barmera[,mnth]), NA, mean(c(kom[,mnth],barmera[,mnth])))
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
source(.trPaths[5], echo=TRUE, max.deparse.length=200)
ifelse(is.na(kom[,mnth]) & is.na(barmera[,mnth]), NA, mean(c(kom[,mnth],barmera[,mnth])))
is.na(kom[,mnth])
is.na(barmera[,mnth])
ifelse(is.na(kom[,mnth]) ! is.na(barmera[,mnth]), NA, mean(c(kom[,mnth],barmera[,mnth])))
ifelse(is.na(kom[,mnth]) | is.na(barmera[,mnth]), NA, mean(c(kom[,mnth],barmera[,mnth])))
ifelse(is.na(kom[,mnth]) & is.na(barmera[,mnth]), NA, mean(c(kom[,mnth],barmera[,mnth]),na.rm=T))
year <- 1
mnth <- 1
ifelse(is.na(kom[year,mnth]) & is.na(barmera[year,mnth]), NA, mean(c(kom[year,mnth],barmera[year,mnth]),na.rm=T))
is.na(kom[year,mnth])
is.na(barmera[year,mnth])
str(barmera)
str(kom)
kom[year,mnth]
mnth <- 4
kom[year,mnth]
barmera[year,mnth]
is.na(kom[year,mnth])
is.na(barmera[year,mnth])
ifelse(is.na(kom[year,mnth]) & is.na(barmera[year,mnth]), NA, mean(c(kom[year,mnth],barmera[year,mnth]),na.rm=T))
year <- 40
ifelse(is.na(kom[year,mnth]) & is.na(barmera[year,mnth]), NA, mean(c(kom[year,mnth],barmera[year,mnth]),na.rm=T))
is.na(kom[year,mnth])
is.na(barmera[year,mnth])
for (year in 1:132) {
for(mnth in 4:15) {
ifelse(is.na(kom[year,mnth]) & is.na(barmera[year,mnth]), NA, mean(c(kom[year,mnth],barmera[year,mnth]),na.rm=T))
}
cobdogla <- matrix(nrow=132, ncol=16)
cobdogla <- matrix(nrow=132, ncol=16)
cobdogla <- matrix(nrow=132, ncol=16)
cobdogla
paste(barmera[,2],'_3', sep='')
cobdogla[,1] <- kom[,1]
cobdogla[,2] <- paste(barmera[,2],'_3', sep='')
cobdogla[,3] <- 1884:2015
cobdogla
?data.frame
cobdogla <- kom
cobdogla[,2] <- paste(barmera[,2],'_3', sep='')
str(cobdogla)
for (year in 1:132) {
for(mnth in 4:15) {
cobdogla[year, mnth] <- ifelse(is.na(kom[year,mnth]) & is.na(barmera[year,mnth]), NA, mean(c(kom[year,mnth],barmera[year,mnth]),na.rm=T))
}
}
head(cobdogla, 20)
N <- nrow(cobdogla)
months <- c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec")
X <- data.frame(rep(cobdogla[,3], times=2), rep(c("obs","imp"), each=N))
names(X) <- c("year","values")
for (m in 1:12) {
X[,m+2] <- c(cobdogla[,m+3], random.imp(cobdogla[,m+3]))
names(X)[m+2] <- months[m]
print(histogram( ~ X[,m+2] | X$values, xlab="Rainfall (mm)", main=paste("Histogram of rainfall for the month of ",months[m])))
pause()
}
X$Annual <- rowSums(X[, 3:14])
cobdogla[1:N, 4:16] <- X[(N+1):(2*N), 3:15]
head(cobdogla, 20)
write.xlsx(cobdogla, xlsxin, sheetName="Cobby_Imputed", showNA=TRUE, append=TRUE)
xlsxin
write.xlsx(cobdogla, xlsxin, sheetName="Cobby_Imputed", showNA=TRUE, append=TRUE)
cobdogla <- kom
cobdogla[,2] <- paste(barmera[,2],'_3', sep='')
for (year in 1:132) {
for(mnth in 4:15) {
cobdogla[year, mnth] <- ifelse(is.na(kom[year,mnth]) & is.na(barmera[year,mnth]), NA,
round(mean(c(kom[year,mnth],barmera[year,mnth]),na.rm=T),1))
}
}
head(cobdogla, 20)
N <- nrow(cobdogla)
months <- c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec")
X <- data.frame(rep(cobdogla[,3], times=2), rep(c("obs","imp"), each=N))
names(X) <- c("year","values")
for (m in 1:12) {
X[,m+2] <- c(cobdogla[,m+3], random.imp(cobdogla[,m+3]))
names(X)[m+2] <- months[m]
print(histogram( ~ X[,m+2] | X$values, xlab="Rainfall (mm)", main=paste("Histogram of rainfall for the month of ",months[m])))
pause()
}
X$Annual <- round(rowSums(X[, 3:14],1)
cobdogla[1:N, 4:16] <- X[(N+1):(2*N), 3:15]
X$Annual <- round(rowSums(X[, 3:14]),1)
cobdogla[1:N, 4:16] <- X[(N+1):(2*N), 3:15]
head(cobdogla, 20)
write.xlsx(cobdogla, xlsxin, sheetName="Cobby_Imputed", showNA=TRUE, append=TRUE)
write.xlsx(cobdogla, xlsxin, sheetName="Cobby_Imputed", showNA=TRUE, append=TRUE)
write.xlsx(cobdogla, xlsxin, sheetName="Cobby_Imputed", showNA=TRUE, append=TRUE)
q()
